{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CRUD con Django, HTMX y MySQL">
    <meta name="keywords" content="CRUD, HTMX, Django, Python, MySQL, Bootstrap">
    <meta name="author" content="Urian Viera - FullStack Developer">
    <title>CRUD con Django - HTMX y MySQL</title>
    <link rel="icon" type="image/png" href="{% static 'assets/img/favicon.png'%}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.3/css/dataTables.bootstrap5.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{% static 'assets/css/home.css' %}">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold fs-4" href="/">
                CRUD con <span class="color_primary">Django</span> - <span class="color_secondary">HTMX</span> y
                <span class="color_mysql">MySQL</span>
            </a>
        </div>
    </nav>


    <div class="container mt-5 mb-5">
        <div class="row mb-4">
        {% block content %}
        {% endblock %}
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.5/dist/htmx.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.bootstrap5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastjs-notifications@1.11.14/toast-notifications.min.js"></script>
    <script src="{% static 'assets/js/home.js' %}"></script>
    <script>
// SOLUCIÓN 1: Usar CDN oficial de DataTables para español
function initializeDataTables() {
    let tables = document.querySelectorAll("table");
    if (tables.length == 0) return;
  
    tables.forEach((table) => {
      let tableId = table.id;
  
      // Verificar si la tabla ya tiene DataTables inicializado
      if ($.fn.DataTable.isDataTable(`#${tableId}`)) {
        $(`#${tableId}`).DataTable().destroy();
      }
  
      // Inicializar DataTables con CDN de idioma
      $(`#${tableId}`).DataTable({
        pageLength: 10,
        language: {
          url: "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json",
        },
        responsive: true,
        dom: "Blfrtip",
        lengthMenu: [
          [10, 25, 50, -1],
          [10, 25, 50, "Todos"],
        ],
      });
    });
  }
  
  // Inicializar cuando se carga la página
  document.addEventListener("DOMContentLoaded", function () {
    initializeDataTables();
  });
  
  // Reinicializar después de que HTMX cargue contenido
  document.body.addEventListener("htmx:afterSettle", function (evt) {
    if (evt.detail.target.querySelector("table")) {
      setTimeout(function () {
        initializeDataTables();
      }, 150);
    }
  });
  
  document.body.addEventListener("htmx:afterSwap", function (evt) {
    if (evt.detail.target.querySelector("table")) {
      setTimeout(function () {
        initializeDataTables();
      }, 150);
    }
  });
  
  // Limpiar DataTables antes del intercambio
  document.body.addEventListener("htmx:beforeSwap", function (evt) {
    $("table").each(function () {
      if ($.fn.DataTable.isDataTable(this)) {
        $(this).DataTable().destroy();
      }
    });
  });
</script>
</body>
</html>
